{% extends 'base.html' %}
{% block title %}
  Данные документа о поступлении
{% endblock %}
{% block content %}
  {% include 'includes/form.html' with card_header='Добавление учебника' button='Добавить' %}
  <form method="POST">
    {% csrf_token %}
    <button type="submit" class="btn btn-success" name="save">
      Сохранить изменения
    </button>
    <table class="table table-bordered table-hover table-sm">
      <tr>
        <th class="col-5">Наименование</th><th class="col">Часть</th><th class="col">Количество</th>
        <th class="col">Цена</th><th class="col">Год издания</th><th class="col-2">Комментарий</th>
        <th class="col">Действия</th>
      </tr>
      {% load user_filters %}
      {{ formset.management_form }}
      {% for form in formset %}
        {{ form.id }}
        <tr>
          {% for item in form %}
            {% if forloop.first %}
              <td>
                {{ form.instance.book }}
              </td>
            {% elif not forloop.last %}
              <td>
                {{ item|addclass:'form-control form-control-sm' }}
              </td>
            {% endif %}
          {% endfor %}
          <td>
            <a href="{% url 'funds:income_book_del' doc_id form.instance.pk %}"
               role="button" class="btn btn-danger btn-sm">Удалить
            </a>
          </td>
        </tr>
      {% endfor %}
    </table>
  </form>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
          integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
  <script>
      $(document).ready(function () {
          $('#id_book').select2({
              ajax: {
                  url: '{% url 'funds:index' %}',
                  dataType: 'json',
                  processResults: function (data) {
                      return {
                          results: $.map(data, function (item) {
                              return {id: item.id, text: item.text};
                          })
                      };
                  }
              },
              minimumInputLength: 3,
              language: "ru",
              width: "100%",
          });
      });
  </script>
{% endblock %}